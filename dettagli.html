<!DOCTYPE html>
<html lang="it">
<head>
<meta charset="UTF-8">
<title>Dettagli Libro</title>

<link rel="stylesheet" href="style.css">
</head>

<body>

<header>üìò Dettagli Libro</header>

<div class="detail-wrapper">
  <div class="container" id="contenuto">
    <p>Caricamento...</p>
  </div>
</div>

<script type="module">

import { Libro } from "./richiesteAPI.js";

const raw = JSON.parse(
  sessionStorage.getItem("libroSelezionato")
);
if (!raw) {
  alert("Nessun libro selezionato");
  window.location.href = "index.html";
}
const libro = new Libro(raw);
console.log(raw);
console.log(libro);

async function caricaDettagli(){

  await libro.getDettagli();

  mostra();
}

function mostra(){

  const div = document.getElementById("contenuto");

  div.innerHTML = `

  <div class="cover">
    <img src="${libro.googleThumbnail || libro.getCoverUrl('L')}" alt="${libro.titolo}">
  </div>

  <div class="info">

    <h2>${libro.titolo}</h2>
    <p class="autore">${libro.autori}</p>

    <div class="meta-row">
      ${libro.anno ? `<span class="badge">${libro.anno}</span>` : ""}
      ${libro.lingua ? `<span class="badge badge-secondary">${libro.lingua.toUpperCase()}</span>` : ""}
      ${libro.pagine ? `<span class="badge badge-light">${libro.pagine} pagine</span>` : ""}
    </div>

    ${libro.rating ? `
      <p class="rating">
        ‚≠ê ${libro.rating} 
        <span class="votes">(${libro.numeroVoti || 0} voti)</span>
      </p>
    ` : ""}

    <div class="info-grid">
      <p><span class="label">Editore:</span> ${libro.editore || "N/A"}</p>
      <p><span class="label">ISBN:</span> ${libro.isbn || "N/A"}</p>
      ${libro.dataPubblicazione ? `<p><span class="label">Pubblicazione:</span> ${libro.dataPubblicazione}</p>` : ""}
    </div>

    ${
      libro.categorie && libro.categorie.length > 0
        ? `
        <div class="categorie">
          ${libro.categorie
            .map(cat => `<span class="badge badge-outline">${cat}</span>`)
            .join("")}
        </div>
        `
        : ""
    }

  </div>

  <div class="descrizione">

    <h3>Descrizione</h3>
    <p>${libro.descrizione || "Nessuna descrizione disponibile."}</p>

  </div>

  <div class="actions">

    <a href="index.html">‚¨Ö Torna alla ricerca</a>

    ${
      libro.previewLink
        ? `<a href="${libro.previewLink}" target="_blank">üìñ Anteprima</a>`
        : ""
    }

    ${
      libro.infoLink
        ? `<a href="${libro.infoLink}" target="_blank">‚ÑπÔ∏è Google Books</a>`
        : ""
    }

  </div>

`;

}

caricaDettagli();

</script>

</body>
</html>
